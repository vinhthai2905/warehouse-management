{% extends 'main.html' %}
{% load static %}


{% block link %}
    <link rel="stylesheet" href="{% static 'css/sale_staff/export-detail.css' %}">
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css'>
{% endblock link %}

{% block main-content %}
    <h2 id="title">Chi tiết yêu cầu xuất hàng bán</h2>

    <div id="export-receipt">
        <section>
            <dl id="export-detail">
                <dt>Thời gian yêu cầu: {{ export_info.date_request }}</dt>
                <dt>Nhân viên yêu cầu: {{ export_info.request_employee }}</dt>
                <dt>Nhân viên xuất hàng: {{ export_info.export_employee }}</dt>
                <dt>Trạng thái: {{ export_info.status }}</dt>
            </dl>
        </section>

        <section>
            <table id="table-content">
                <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên mặt hàng</th>
                    <th>Số lượng</th>
                    <th>Ghi chú</th>
                </tr>
                </thead>
                <tbody>
                {% for product in export_product_dict %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ product.name }}</td>
                        <td>{{ product.quantity }}</td>
                        <td>{{ product.note }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </section>


    </div>

    <section>
        <div id="button-row">
            <a href="{% url 'export-request' %}">
                <button id="previous-button">Quay lại</button>
            </a>
            <form action="{% url 'confirm-export' %}" method="post"
                  onsubmit="return confirm('Bạn có chắc chắn muốn xác nhận đã nhận đủ?');">
                {% csrf_token %}
                <input type="hidden" name="request_id" value="{{ request.GET.request_id }}">
                <input type="hidden" id="confirmed_at" name="confirmed_at">
                <button id="confirmation-button" type="submit">Xác nhận đã nhận đủ</button>
            </form>
        </div>
    </section>

    <script>
        function confirmProceed() {
            const proceed = confirm('Bạn có chắc chắn muốn xác nhận đã nhận đủ?');
            if (proceed) {
                const now = new Date().toISOString();
                document.getElementById('confirmed_at').value = now;
                return true; // allow form submit
            } else {
                console.log('User cancelled confirmation.');
                return false; // prevent form submit
            }
        }
    </script>
{% endblock main-content %}