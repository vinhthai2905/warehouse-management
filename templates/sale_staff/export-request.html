{% extends 'main.html' %}
{% load static %}

{% block link %}
    <link rel="stylesheet" href="{% static 'css/sale_staff/export-request.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock link %}

{% block main-content %}
    <div class="export-manager">

        <!-- status tabs -->
        <div class="status-tabs">
            <span class="status-tab active" data-target="all">Tất cả</span>
            <span class="status-tab" data-target="pending">Chưa duyệt</span>
            <span class="status-tab" data-target="approved">Đã duyệt</span>
        </div>

        <!-- panel: All -->
        <div id="all" class="status-panel">
            <table class="req-table">
                <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã yêu cầu</th>
                    <th>Thời gian yêu cầu</th>
                    <th>Nhân viên yêu cầu</th>
                    <th>Trạng thái</th>
                    <th>Chi tiết yêu cầu</th>
                </tr>
                </thead>
                <tbody>
                {% for e_request in export_request_dict %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ e_request.id }}</td>
                        <td>{{ e_request.date|date:'H:i d/m/Y' }}</td>
                        <td>{{ e_request.employee }}</td>
                        <td>
            <span class="status {% if e_request.status == 'Chưa duyệt' %}pending{% elif e_request.status == 'Đã duyệt' %}approved{% endif %}">
              {{ e_request.status }}
            </span>
                        </td>
                        <td>
                            <a href="{% url 'export-detail' %}?request_id={{ e_request.id }}&status={{ e_request.status }}&request_date={{ e_request.date|urlencode }}&review_date={{ e_request.review_date|urlencode }}&export_date={{ e_request.export_date|urlencode }}"
                               class="detail-link">
                                Xem chi tiết
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- panel: Pending -->
        <div id="pending" class="status-panel hidden">
            <p class="empty-note">Hiện không có phiếu nào chờ duyệt.</p>
        </div>

        <!-- panel: Approved -->
        <div id="approved" class="status-panel hidden">
            <p class="empty-note">Hiện không có phiếu đã duyệt.</p>
        </div>
    </div>

    <script>
        document.querySelectorAll('.status-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.status-tab').forEach(t => t.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.status-panel').forEach(p => p.classList.add('hidden'));
                document.getElementById(btn.dataset.target).classList.remove('hidden');
            });
        });
    </script>
{% endblock main-content %}